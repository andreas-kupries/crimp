# -*- tcl -*-
# -------------------------------------------------------------------------

source [file join \
            [file dirname [file join [pwd] [info script]]] \
            testutilities.tcl]

testsNeedTcl     8.5
testsNeedTcltest 2

support { useLocalFile synth.tcl }
support { useC [mainPath _test/lib]/crimp_core* crimp::core no }
testing { useC [mainPath _test/lib]/crimp*      crimp       no }

# -------------------------------------------------------------------------
## Geometry manipulation. Concat multiple images into one
## (side by side, horizontal, or vertical)
# -------------------------------------------------------------------------

test crimp-montage-1.0 {image montage, wrong\#args, not enough} -body {
    crimp montage
} -returnCodes error -result {wrong # args: should be "crimp montage subcommand ?argument ...?"}

test crimp-montage-1.1 {image montage, invalid method} -body {
    crimp montage BOGUS IMAGE
} -returnCodes error -result {unknown or ambiguous subcommand "BOGUS": must be horizontal, or vertical}

# -------------------------------------------------------------------------

# -------------------------------------------------------------------------
# Test images are (0,0,5,5)
# Cases:
# -border none, const, extend, mirror, replicate, wrap
# horiz  -align vertic: top, center, bottom
# vertic -align horiz:  left, middle, right
# grey8, grey16, grey32, rgb, rgba, hsv, float, fpcomplex
# input location -> of first image, ignoring remainder.
#
# 2* 6*3*8 = 288
# -------------------------------------------------------------------------

# -------------------------------------------------------------------------

test crimp-montage-2.0 {image montage horizontal, wrong\#args, not enough} -body {
    crimp montage horizontal
} -returnCodes error -result {wrong # args: should be "crimp montage horizontal ?-border B? ?-align A? image ?image...?"}

test crimp-montage-2.1 {image montage horizontal, wrong\#args, invalid arguments} -body {
    crimp montage horizontal BOGUS
} -returnCodes error -result {invalid image format}

set k 0
foreach itype [types] {
    test crimp-montage-2.2.$k "[origin] image montage horizontal, invalid arguments" -body {
        crimp montage horizontal -border FOO [$itype]
    } -returnCodes error -result {Unknown border type "FOO", expected one of const, extend, mirror, replicate, or wrap}
    incr k
}

test crimp-montage-2.3 {image montage horizontal, invalid arguments} -body {
    crimp montage horizontal -align FOO [grey8]
} -returnCodes error -result {Illegal vertical alignment "FOO", expected bottom, center, or top}

test crimp-montage-2.4 {image montage horizontal, invalid arguments} -body {
    crimp montage horizontal -bogus FOO [grey8]
} -returnCodes error -result {Unknown option "-bogus", expected -align, or -border}

test crimp-montage-2.5 {image montage horizontal, invalid arguments} -body {
    crimp montage horizontal [grey8] [float]
} -returnCodes error -result {Type mismatch, unable to montage grey8 to float}

# -------------------------------------------------------------------------

set k 0
foreach itype [greys] {
    test crimp-montage-3.0.$k "[origin] image montage horizontal, $itype, simple" -body {
        astcl [crimp montage horizontal [$itype] [$itype]]
    } -result [iconst $itype 0 0 10 5 {
         0  1  2  3  4  0  1  2  3  4
         5  6  7  8  9  5  6  7  8  9
        10 11 12 13 14 10 11 12 13 14
        15 16 17 18 19 15 16 17 18 19
        20 21 22 23 24 20 21 22 23 24
    }]
    incr k
}

test crimp-montage-3.0.3 "[origin] image montage horizontal, rgb, simple" -body {
    astcl [crimp montage horizontal [rgb] [rgb]]
} -result [iconst rgb 0 0 10 5 {
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74} { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70} { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62} { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66} { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72} {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
}]

test crimp-montage-3.0.4 "[origin] image montage horizontal, rgba, simple" -body {
    astcl [crimp montage horizontal [rgba] [rgba]]
} -result [iconst rgba 0 0 10 5 {
    { 0  1  2 75} {15 20 25 84} {30 31 32 85} {57 58 59 86} {60 69 74 87} { 0  1  2 75} {15 20 25 84} {30 31 32 85} {57 58 59 86} {60 69 74 87}
    { 3  4  5 76} {16 21 26 83} {41 42 33 90} {56 55 54 89} {68 61 70 88} { 3  4  5 76} {16 21 26 83} {41 42 33 90} {56 55 54 89} {68 61 70 88}
    { 6  7  8 77} {17 22 27 82} {40 43 34 91} {51 52 53 98} {73 67 62 97} { 6  7  8 77} {17 22 27 82} {40 43 34 91} {51 52 53 98} {73 67 62 97}
    { 9 10 11 78} {18 23 28 81} {39 44 35 92} {50 49 48 99} {71 63 66 96} { 9 10 11 78} {18 23 28 81} {39 44 35 92} {50 49 48 99} {71 63 66 96}
    {12 13 14 79} {19 24 29 80} {38 37 36 93} {45 46 47 94} {64 65 72 95} {12 13 14 79} {19 24 29 80} {38 37 36 93} {45 46 47 94} {64 65 72 95}
}]

test crimp-montage-3.0.5 "[origin] image montage horizontal, hsv, simple" -body {
    astcl [crimp montage horizontal [hsv] [hsv]]
} -result [iconst hsv 0 0 10 5 {
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74} { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70} { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62} { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66} { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72} {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
}]

test crimp-montage-3.0.6 "[origin] image montage horizontal, float, simple" -body {
    astclf 1 [crimp montage horizontal [float] [float]]
} -result [iconst float 0 0 10 5 {
     0.0  1.0  2.0  3.0  4.0  0.0  1.0  2.0  3.0  4.0
     5.0  6.0  7.0  8.0  9.0  5.0  6.0  7.0  8.0  9.0
    10.0 11.0 12.0 13.0 14.0 10.0 11.0 12.0 13.0 14.0
    15.0 16.0 17.0 18.0 19.0 15.0 16.0 17.0 18.0 19.0
    20.0 21.0 22.0 23.0 24.0 20.0 21.0 22.0 23.0 24.0
}]

test crimp-montage-3.0.7 "[origin] image montage horizontal, fpcomplex, simple" -body {
    astclf 1 [crimp montage horizontal [fpcomplex] [fpcomplex]]
} -result [iconst fpcomplex 0 0 10 5 {
    { 0.0  1.0} {15.0 20.0} {30.0 31.0} {57.0 58.0} {60.0 69.0} { 0.0  1.0} {15.0 20.0} {30.0 31.0} {57.0 58.0} {60.0 69.0}
    { 3.0  4.0} {16.0 21.0} {41.0 42.0} {56.0 55.0} {68.0 61.0} { 3.0  4.0} {16.0 21.0} {41.0 42.0} {56.0 55.0} {68.0 61.0}
    { 6.0  7.0} {17.0 22.0} {40.0 43.0} {51.0 52.0} {73.0 67.0} { 6.0  7.0} {17.0 22.0} {40.0 43.0} {51.0 52.0} {73.0 67.0}
    { 9.0 10.0} {18.0 23.0} {39.0 44.0} {50.0 49.0} {71.0 63.0} { 9.0 10.0} {18.0 23.0} {39.0 44.0} {50.0 49.0} {71.0 63.0}
    {12.0 13.0} {19.0 24.0} {38.0 37.0} {45.0 46.0} {64.0 65.0} {12.0 13.0} {19.0 24.0} {38.0 37.0} {45.0 46.0} {64.0 65.0}
}]

# -------------------------------------------------------------------------

test crimp-montage-4.0 {image montage vertical, wrong\#args, not enough} -body {
    crimp montage vertical
} -returnCodes error -result {wrong # args: should be "crimp montage vertical ?-border B? ?-align A? image ?image...?"}

test crimp-montage-4.1 {image montage vertical, wrong\#args, invalid arguments} -body {
    crimp montage vertical BOGUS
} -returnCodes error -result {invalid image format}

set k 0
foreach itype [types] {
    test crimp-montage-4.2.$k "[origin] image montage vertical, invalid arguments" -body {
        crimp montage vertical -border FOO [$itype]
    } -returnCodes error -result {Unknown border type "FOO", expected one of const, extend, mirror, replicate, or wrap}
    incr k
}

test crimp-montage-4.3 {image montage vertical, invalid arguments} -body {
    crimp montage vertical -align FOO [grey8]
} -returnCodes error -result {Illegal horizontal alignment "FOO", expected left, middle, or right}

test crimp-montage-4.4 {image montage vertical, invalid arguments} -body {
    crimp montage vertical -bogus FOO [grey8]
} -returnCodes error -result {Unknown option "-bogus", expected -align, or -border}

test crimp-montage-4.5 {image montage vertical, invalid arguments} -body {
    crimp montage vertical [grey8] [float]
} -returnCodes error -result {Type mismatch, unable to montage grey8 to float}

# -------------------------------------------------------------------------

set k 0
foreach itype [greys] {
    test crimp-montage-5.0.$k "[origin] image montage vertical, $itype, simple" -body {
        astcl [crimp montage vertical [$itype] [$itype]]
    } -result [iconst $itype 0 0 5 10 {
         0  1  2  3  4
         5  6  7  8  9
        10 11 12 13 14
        15 16 17 18 19
        20 21 22 23 24
         0  1  2  3  4
         5  6  7  8  9
        10 11 12 13 14
        15 16 17 18 19
        20 21 22 23 24
    }]
    incr k
}

test crimp-montage-5.0.3 "[origin] image montage vertical, rgb, simple" -body {
    astcl [crimp montage vertical [rgb] [rgb]]
} -result [iconst rgb 0 0 5 10 {
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
}]

test crimp-montage-5.0.4 "[origin] image montage vertical, rgba, simple" -body {
    astcl [crimp montage vertical [rgba] [rgba]]
} -result [iconst rgba 0 0 5 10 {
    { 0  1  2 75} {15 20 25 84} {30 31 32 85} {57 58 59 86} {60 69 74 87}
    { 3  4  5 76} {16 21 26 83} {41 42 33 90} {56 55 54 89} {68 61 70 88}
    { 6  7  8 77} {17 22 27 82} {40 43 34 91} {51 52 53 98} {73 67 62 97}
    { 9 10 11 78} {18 23 28 81} {39 44 35 92} {50 49 48 99} {71 63 66 96}
    {12 13 14 79} {19 24 29 80} {38 37 36 93} {45 46 47 94} {64 65 72 95}
    { 0  1  2 75} {15 20 25 84} {30 31 32 85} {57 58 59 86} {60 69 74 87}
    { 3  4  5 76} {16 21 26 83} {41 42 33 90} {56 55 54 89} {68 61 70 88}
    { 6  7  8 77} {17 22 27 82} {40 43 34 91} {51 52 53 98} {73 67 62 97}
    { 9 10 11 78} {18 23 28 81} {39 44 35 92} {50 49 48 99} {71 63 66 96}
    {12 13 14 79} {19 24 29 80} {38 37 36 93} {45 46 47 94} {64 65 72 95}
}]

test crimp-montage-5.0.5 "[origin] image montage vertical, hsv, simple" -body {
    astcl [crimp montage vertical [hsv] [hsv]]
} -result [iconst hsv 0 0 5 10 {
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
    { 0  1  2} {15 20 25} {30 31 32} {57 58 59} {60 69 74}
    { 3  4  5} {16 21 26} {41 42 33} {56 55 54} {68 61 70}
    { 6  7  8} {17 22 27} {40 43 34} {51 52 53} {73 67 62}
    { 9 10 11} {18 23 28} {39 44 35} {50 49 48} {71 63 66}
    {12 13 14} {19 24 29} {38 37 36} {45 46 47} {64 65 72}
}]

test crimp-montage-5.0.6 "[origin] image montage vertical, float, simple" -body {
    astclf 1 [crimp montage vertical [float] [float]]
} -result [iconst float 0 0 5 10 {
     0.0  1.0  2.0  3.0  4.0
     5.0  6.0  7.0  8.0  9.0
    10.0 11.0 12.0 13.0 14.0
    15.0 16.0 17.0 18.0 19.0
    20.0 21.0 22.0 23.0 24.0
     0.0  1.0  2.0  3.0  4.0
     5.0  6.0  7.0  8.0  9.0
    10.0 11.0 12.0 13.0 14.0
    15.0 16.0 17.0 18.0 19.0
    20.0 21.0 22.0 23.0 24.0
}]

test crimp-montage-5.0.7 "[origin] image montage vertical, fpcomplex, simple" -body {
    astclf 1 [crimp montage vertical [fpcomplex] [fpcomplex]]
} -result [iconst fpcomplex 0 0 5 10 {
    { 0.0  1.0} {15.0 20.0} {30.0 31.0} {57.0 58.0} {60.0 69.0}
    { 3.0  4.0} {16.0 21.0} {41.0 42.0} {56.0 55.0} {68.0 61.0}
    { 6.0  7.0} {17.0 22.0} {40.0 43.0} {51.0 52.0} {73.0 67.0}
    { 9.0 10.0} {18.0 23.0} {39.0 44.0} {50.0 49.0} {71.0 63.0}
    {12.0 13.0} {19.0 24.0} {38.0 37.0} {45.0 46.0} {64.0 65.0}
    { 0.0  1.0} {15.0 20.0} {30.0 31.0} {57.0 58.0} {60.0 69.0}
    { 3.0  4.0} {16.0 21.0} {41.0 42.0} {56.0 55.0} {68.0 61.0}
    { 6.0  7.0} {17.0 22.0} {40.0 43.0} {51.0 52.0} {73.0 67.0}
    { 9.0 10.0} {18.0 23.0} {39.0 44.0} {50.0 49.0} {71.0 63.0}
    {12.0 13.0} {19.0 24.0} {38.0 37.0} {45.0 46.0} {64.0 65.0}
}]

# -------------------------------------------------------------------------
testsuiteCleanup

# Local variables:
# mode: tcl
# indent-tabs-mode: nil
# End:
