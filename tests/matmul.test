# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0
## (c) 2011-2016 Andreas Kupries
# # ## ### ##### ######## ############# #####################

kt check Tcl     8.5
kt check tcltest 2

kt source support/synth.tcl

kt local support crimp::core
kt local testing crimp

# -------------------------------------------------------------------------
## Transform matrix multiplication.
## Testing C code here.
## Must not use invalid image types, these cause abort by assertion!
## This is what is behind the 'projective transforms' used by 'wrap projective'.
# -------------------------------------------------------------------------

test crimp-matrix-multiply-1.0 {transform matrix multiplication, wrong\#args, not enough} -body {
    crimp::matmul3x3_float
} -returnCodes error -result [wa crimp::matmul3x3_float matA matB]

test crimp-matrix-multiply-1.1 {transform matrix multiplication, wrong\#args, not enough} -body {
    crimp::matmul3x3_float A
} -returnCodes error -result [wa crimp::matmul3x3_float matA matB]

test crimp-matrix-multiply-1.2 {transform matrix multiplication, wrong\#args, too many} -body {
    crimp::matmul3x3_float A B toomuch
} -returnCodes error -result [wa crimp::matmul3x3_float matA matB]

# TODO: bad arguments - not 3x3 matrices

# -------------------------------------------------------------------------

test crimp-matrix-multiply-2.0 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [mid] [mid]]
} -result [iconst float 0 0 3 3 {
    1.0 0.0  0.0
    0.0 1.0 0.0
    0.0 0.0  1.0
}]

test crimp-matrix-multiply-2.1 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [mid] [mtest]]
} -result [iconst float 0 0 3 3 {
    1.0 0.0 5.0
    0.0 1.0 2.0
    0.0 0.0 1.0
}]

test crimp-matrix-multiply-2.2 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [mid] [mtestb]]
} -result [iconst float 0 0 3 3 {
    0.0 3.0 0.0
    2.0 0.0 4.0
    0.0 5.0 0.0
}]


test crimp-matrix-multiply-2.3 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [midt] [mid]]
} -result [iconst float 0 0 3 3 {
    0.0 0.0 1.0
    0.0 1.0 0.0
    1.0 0.0 0.0
}]

test crimp-matrix-multiply-2.4 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [midt] [mtest]]
} -result [iconst float 0 0 3 3 {
    0.0 0.0 1.0
    0.0 1.0 2.0
    1.0 0.0 5.0
}]

test crimp-matrix-multiply-2.5 {transform matrix multiplication, float} -body {
    astclf 1 [crimp::matmul3x3_float [midt] [mtestb]]
} -result [iconst float 0 0 3 3 {
    0.0 5.0 0.0
    2.0 0.0 4.0
    0.0 3.0 0.0
}]

# -------------------------------------------------------------------------

test crimp-matrix-multiply-3.0 {transform matrix multiplication, wrong\#args, not enough} -body {
    crimp::matmul3x3_double
} -returnCodes error -result [wa crimp::matmul3x3_double matA matB]

test crimp-matrix-multiply-3.1 {transform matrix multiplication, wrong\#args, not enough} -body {
    crimp::matmul3x3_double A
} -returnCodes error -result [wa crimp::matmul3x3_double matA matB]

test crimp-matrix-multiply-3.2 {transform matrix multiplication, wrong\#args, too many} -body {
    crimp::matmul3x3_double A B toomuch
} -returnCodes error -result [wa crimp::matmul3x3_double matA matB]

# TODO: bad arguments - not 3x3 matrices

# -------------------------------------------------------------------------

test crimp-matrix-multiply-4.0 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmid] [dmid]]
} -result [iconst double 0 0 3 3 {
    1.0 0.0  0.0
    0.0 1.0 0.0
    0.0 0.0  1.0
}]

test crimp-matrix-multiply-4.1 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmid] [dmtest]]
} -result [iconst double 0 0 3 3 {
    1.0 0.0 5.0
    0.0 1.0 2.0
    0.0 0.0 1.0
}]

test crimp-matrix-multiply-4.2 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmid] [dmtestb]]
} -result [iconst double 0 0 3 3 {
    0.0 3.0 0.0
    2.0 0.0 4.0
    0.0 5.0 0.0
}]


test crimp-matrix-multiply-4.3 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmidt] [dmid]]
} -result [iconst double 0 0 3 3 {
    0.0 0.0 1.0
    0.0 1.0 0.0
    1.0 0.0 0.0
}]

test crimp-matrix-multiply-4.4 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmidt] [dmtest]]
} -result [iconst double 0 0 3 3 {
    0.0 0.0 1.0
    0.0 1.0 2.0
    1.0 0.0 5.0
}]

test crimp-matrix-multiply-4.5 {transform matrix multiplication, double} -body {
    astclf 1 [crimp::matmul3x3_double [dmidt] [dmtestb]]
} -result [iconst double 0 0 3 3 {
    0.0 5.0 0.0
    2.0 0.0 4.0
    0.0 3.0 0.0
}]

# -------------------------------------------------------------------------
cleanupTests

# Local variables:
# mode: tcl
# indent-tabs-mode: nil
# End:
