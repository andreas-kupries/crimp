# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0
## (c) 2011-2016 Andreas Kupries
# # ## ### ##### ######## ############# #####################

kt check Tcl     8.5
kt check tcltest 2

kt source support/synth.tcl

kt local testing crimp::core

# -------------------------------------------------------------------------
## Core math: bilinear interpolation

test crimp-core-math-2linear-1.0 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.1 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear A
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.2 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear A B
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.3 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear A B C
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.4 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear A B C D
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.5 {interpolate bilinear, wrong args, not enough} -body {
    crimp interpolate bilinear A B C D XF
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

test crimp-core-math-2linear-1.6 {interpolate bilinear, wrong args, too many} -body {
    crimp interpolate bilinear A B C D XF YF XXX
} -returnCodes error -result [wa crimp interpolate bilinear a b c d xf yf]

# -------------------------------------------------------------------------
## Fixed functionality

test crimp-core-math-2linear-2.0 {interpolate bilinear, fixed setup} -body {
    crimp interpolate bilinear 0 0.5 0.5 1 0.5 0.5
} -result 0.5 -match epsilon

# -------------------------------------------------------------------------
## Randomized functionality.

apply {{} {
    set n 0
    foreach _ [iota 500] {
        # Compute an interpolation.
        set a [rand -10 10]
        set b [rand -10 10]
        set c [rand -10 10]
        set d [rand -10 10]
        set x [rand 0 1]
        set y [rand 0 1]
        set x1 [crimp interpolate linear $a $b $x]
        set x2 [crimp interpolate linear $c $d $x]

        set z [expr {$x1+($x2-$x1)*$y}]

        # And check
        test crimp-core-math-2linear-3.$n "interpolate bilinear, fuzz" -body {
            crimp interpolate bilinear $a $b $c $d $x $y
        } -result $z -match 14digits

        unset a b c d x y z x1 x2
        incr n
    }
}}

# -------------------------------------------------------------------------
cleanupTests

# Local variables:
# mode: tcl
# indent-tabs-mode: nil
# End:
